<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/fragments/head :: head}"></th:block>
<body>
<th:block th:replace="~{/fragments/navbar :: nav}"></th:block>

<div class="container">
    <div class="fs-1 mt-2">Welcome <span th:text="${loggedInUser}"></span> to your Dashboard!</div>

    <p class="d-inline-flex gap-1 mt-3">
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample"
                aria-expanded="false" aria-controls="collapseExample">
            Add Task
        </button>
    </p>
    <div class="collapse" th:classappend="${unsuccess ? 'show' : ''}" id="collapseExample">
        <div class="card card-body">
            <form th:action="@{/user/process-todo}" method="post" th:object="${newtodo}">
                <div class="mb-3">
                    <input type="text" class="form-control"
                           th:classappend="${#fields.hasErrors('title') ? 'is-invalid' : ''}" id="title" name="title"
                           placeholder="Title"
                           th:value="${newtodo.title}">
                    <div th:each="e: ${#fields.errors('title')}" class="invalid-feedback" th:text="${e}"></div>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control"
                           th:classappend="${#fields.hasErrors('description') ? 'is-invalid' : ''}" id="description"
                           name="description"
                           placeholder="Description" th:value="${newtodo.description}">
                    <div th:each="e: ${#fields.errors('description')}" class="invalid-feedback" th:text="${e}"></div>
                </div>
                <div class="form-floating mb-3">
                    <select class="form-select" name="priority" id="prioritySelect">
                        <option value="High">High</option>
                        <option value="Medium">Medium</option>
                        <option value="Low" selected>Low</option>
                    </select>
                    <label for="prioritySelect">Priority</label>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control"
                           th:classappend="${#fields.hasErrors('dueDate') ? 'is-invalid' : ''}" id="dueDate"
                           name="dueDate" placeholder="Due"
                           th:value="${newtodo.dueDate}">
                    <div th:each="e: ${#fields.errors('dueDate')}" class="invalid-feedback" th:text="${e}"></div>
                </div>
                <button type="submit" class="btn btn-primary me-3">Add</button>
            </form>
        </div>
    </div>

    <table class="table table-bordered mt-3">
        <thead>
        <tr>
            <th scope="col">Tasks</th>
            <th scope="col">Priority</th>
            <th scope="col">Due</th>
            <th scope="col">Action</th>
        </tr>
        </thead>
        <tbody class="table-group-divider">
        <tr th:each="task : ${tasks}" th:classappend="${task.priority == 'High' ? 'table-danger' : ''}">
            <td>
                <div th:text="${task.title}" th:classappend="${task.isCompleted ? 'completed' : ''}"></div>
                <hr>
                <div th:text="${task.description}"></div>
            </td>
            <td th:text="${task.priority}"></td>
            <td th:text="${#temporals.format(task.dueDate, 'dd-MM-yyyy HH:mm')}"></td>
            <td>
                <button class="btn btn-primary"><i class="bi bi-pencil"></i> Edit</button>
                <button class="btn btn-danger"><i class="bi bi-trash"></i> Delete</button>
                <button class="btn btn-warning">
                    <i class="bi " th:classappend="${task.isCompleted ? 'bi-ban' : 'bi-check-circle'}"></i>
                    <span th:text="${task.isCompleted} ? 'Undo' : 'Done'"></span>
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    let due = document.getElementById("dueDate")
    due.onfocus = function (event) {
        this.type = 'datetime-local';
        this.focus();
    }

    due.onblur = function (event) {
        this.type = 'text';
    }
</script>
</body>
</html>